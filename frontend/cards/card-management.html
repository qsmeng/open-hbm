<main class="main" id="main">
    <div class="main-content">
        <h1>卡牌管理</h1>
        <p>这里是卡牌管理页面，用于查看和管理您的卡牌。</p>
        <button onclick="openCreateCardModal()">创建新卡牌</button>
        <div id="card-list" class="cards-grid">
            <!-- 卡牌列表将动态加载 -->
        </div>
    </div>
</main>

<div id="create-card-modal" class="modal" style="display:none;">
    <div class="modal-content">
        <span class="close" onclick="closeCreateCardModal()">&times;</span>
        <h2>创建新卡牌</h2>
        <form id="create-card-form">
            <label for="card-name">卡牌名称:</label>
            <input type="text" id="card-name" name="card-name" required>
            <label for="card-description">卡牌描述:</label>
            <textarea id="card-description" name="card-description" required></textarea>
            <button type="submit">创建</button>
        </form>
    </div>
</div>

<script>
    async function fetchCardList() {
        try {
            const response = await fetch('/api/cards');
            const cards = await response.json();
            const cardList = document.getElementById('card-list');
            cardList.innerHTML = cards.map(card => `
                <div class="card-item">
                    <h3>${card.name}</h3>
                    <p>${card.description}</p>
                    <button onclick="deleteCard('${card.id}')">删除</button>
                </div>
            `).join('');
        } catch (error) {
            console.error('获取卡牌列表失败:', error);
        }
    }

    async function deleteCard(cardId) {
        if (!confirm('确定要删除这张卡牌吗？')) return;
        try {
            const response = await fetch(`/api/cards/${cardId}`, {
                method: 'DELETE',
            });
            if (!response.ok) throw new Error('删除卡牌失败');
            fetchCardList();
        } catch (error) {
            console.error('删除卡牌失败:', error);
        }
    }

    async function handleCreateCardFormSubmit(event) {
        event.preventDefault();
        const formData = new FormData(event.target);
        const cardData = {
            id: crypto.randomUUID(),
            name: formData.get('card-name'),
            description: formData.get('card-description'),
            image_url: ''
        };
        try {
            const response = await fetch('/api/cards', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(cardData)
            });
            if (!response.ok) throw new Error('创建卡牌失败');
            closeCreateCardModal();
            fetchCardList();
        } catch (error) {
            console.error('创建卡牌失败:', error);
        }
    }

    function openCreateCardModal() {
        document.getElementById('create-card-modal').style.display = 'block';
    }

    function closeCreateCardModal() {
        document.getElementById('create-card-modal').style.display = 'none';
    }

    document.getElementById('create-card-form').addEventListener('submit', handleCreateCardFormSubmit);
    fetchCardList();
</script>