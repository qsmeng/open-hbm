# 半数黑金（Half Black Money）游戏项目

## 项目概述
半数黑金是一款集换式卡牌游戏，结合策略、推理与角色扮演，通过人工智能生成的角色元素，让玩家体验多样化的游戏乐趣。

- [参考]：参考代码和原型
  - [wolf_game](https://github.com/hikariming/AIWolfGame)：AI狼人杀游戏
  - [moments](https://github.com/greyli/moments)：一个基于Flask的社交网络项目
  - [langgraph-demo](https://github.com/q2wxec/langgraph-demo):LangGraph语言模型可视化Demo

## 主要功能

### 游戏流程
**完整系统流程图**:
```
账户系统
├─ 登录/注册
│   ├─ 新用户注册
│   └─ 已有账号登录
│
└─ 主菜单
    ├─ 交易中心
    │   ├─ 卡牌交易
    │   │   ├─ 浏览市场
    │   │   ├─ 购买卡牌
    │   │   └─ 挂售卡牌
    │   │
    │   ├─ 剧本交易
    │   │   ├─ 浏览剧本市场
    │   │   ├─ 购买剧本
    │   │   └─ 发布剧本
    │   │
    │   └─ 角色交易
    │       ├─ 浏览角色市场
    │       ├─ 购买角色
    │       └─ 挂售角色
    │
    ├─ 开始游戏
    │   ├─ 选择模式
    │   │   ├─ 剧本模式 → 选择预设剧本 → 选择角色
    │   │   └─ 自由探索 → AI生成背景故事 → 选择角色
    │   │       ├─ 实时分享: 可在任何轮次开始时分享
    │   │       └─ 中断保存: 非正常结束可"继续对局"
    │   │
    │   ├─ 选择初始卡牌
    │   │   └─ 从卡牌库中选择(最多3张)
    │   │
    │   └─ 游戏开始
    │       │
    │       └─ 回合循环:
    │           ├─ 选择行动 (攻击/驻防/探索)
    │           ├─ 使用卡牌
    │           ├─ 结算效果
    │           │   └─ 可能触发轮次增减
    │           │
    │           └─ 检查游戏结束:
    │               ├─ 剩余轮次>0 → 继续下一回合
    │               └─ 剩余轮次≤0 → 计算得分 → 保存成就
    │                   └─ 可分享剧本/卡牌/角色
    │                       ├─ 正常结束: 管理分享
    │                       └─ 中断: 对局记录中继续
    │
    └─ 个人中心
        ├─ 查看成就
        ├─ 管理收藏
        └─ 账号设置
```

**游戏轮次说明**:
- 剧本模式：轮次数由剧本设定
- 自由探索：初始10个轮次
- 特定行动可能触发轮次增减：
  * 探索成功：+1轮次
  * 使用特殊卡牌：±1-3轮次
  * 达成特殊条件：±1-2轮次

**自由探索模式特殊规则**:
1. 剧本/职业分享：
   - 仅当对局正常结束（剩余轮次为0）时
   - 可在对局记录中管理分享
2. 对局中断处理：
   - 非正常结束（剩余轮次≠0）的对局
   - 可在对局记录中选择"继续对局"
3. 实时分享：
   - 可在任何轮次开始时分享当前对局状态

1. **准备阶段**
   - 开始游戏：选择剧本模式或自由探索模式
   - 剧本选择：
     * 剧本模式：从预设剧本库中选择
     * 自由探索：AI随机生成背景故事，可保存分享为剧本
   - 角色选择：
     * 从预设职业中选择
     * 或AI随机生成角色，可保存分享为新职业
   - 初始卡牌：
     * 从卡牌库中选择(最多3张)
     * 可分享自定义卡组

2. **正式游戏阶段**
   - 回合制行动：每轮选择攻击/驻防/探索等行动
   - 卡牌使用：策略性使用卡牌影响游戏进程
   - 结算阶段：保留最佳卡牌，计算得分和成就

### 核心玩法
3. **AI生成游戏内容**
   - 动态生成背景故事和角色身份
   - 智能生成每轮行动选项
   - AI创作独特的卡牌内容和效果

4. **策略性卡牌对战**
   - 构建个性化初始卡组
   - 每轮策略性使用卡牌
   - 结算阶段保留最有价值卡牌

5. **角色扮演体验**
   - 通过选择塑造角色发展
   - 独特角色身份和技能
   - 丰富的游戏互动体验

### 特色功能
6. **卡牌交易市场**
   - 管理个人卡牌收藏
   - 挂售卡牌与其他玩家交易
   - 未来支持智能卡牌搜索

7. **成就系统**
   - 记录游戏得分和成就
   - 追踪玩家游戏历程
   - 提供可分享的游戏成果

### 游戏控制
8. **智能游戏引导**
   - 自动化游戏流程控制
   - 实时规则校验和提示
   - 确保游戏顺畅进行

### 用户系统
9. **安全账户管理**
   - 完整的注册/登录流程
   - 个人信息保护
   - 游戏数据安全存储

## 当前开发进度
（请在此处填写当前项目的开发进度）

## 下一步计划
（请在此处填写下一步的开发计划）

## 技术栈
- 语言：Python 3.12.7
- 框架：FastAPI
- API文档：Swagger/OpenAPI
- 数据库：MySQL 8.0.31, SQLite
- 缓存：Redis
- 日志：loguru
- 反向代理：nginx
- 容器化：docker-compose
- 大语言模型本地部署：Ollama
- 文生图卡牌生成：comfyui工作流
- 代理：dify-agent

## 项目启动指南

1. **克隆项目:**
   ```bash
   git clone https://github.com/your-repo/half-black-money.git
   cd half-black-money
   ```

2. 配置环境变量:
   - 复制 `.env.example` 为 `.env`，并根据需要修改配置。

3. 启动 Docker 服务:
   ```bash
   docker-compose up --build
   ```
   注意：启动后，可以使用以下命令停止服务：
   ```bash
   docker-compose down
   ```

4. 开发环境下直接启动后端服务:
   ```bash
   python backend/app.py
   ```
   注意：此方式适用于开发环境，默认监听 `5000` 端口。

5. 访问应用:
   - 打开浏览器，访问 http://localhost:80。
   - 后端API服务默认映射到 `5001` 端口。
   - Ollama服务默认映射到 `11434` 端口。
   - Redis服务默认映射到 `6379` 端口。
